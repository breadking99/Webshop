@inherits LayoutComponentBase
@implements IDisposable

<div class="layout-root">
    <header class="layout-header">
        <NavMenu />

        <div class="header-actions">
            @if (!DataManager.IsLoggedIn)
            {
                <span class="auth-links">
                    <NavLink href="/login" Match="NavLinkMatch.All">Login</NavLink>
                    <span class="separator">/</span>
                    <NavLink href="/register" Match="NavLinkMatch.All">Register</NavLink>
                </span>
            }
            else
            {
                <span class="welcome">Welcome, @DataManager.AuthData.Email</span>
                <button type="button"
                        class="logout"
                        @onclick="LogoutAsync">Logout</button>
            }
        </div>
    </header>

    <main class="layout-body">
        <article class="layout-content">
            @Body
        </article>
    </main>
</div>

@code {
    [Inject] private NavigationManager Navigation { get; set; } = default!;

    protected override void OnInitialized()
    {
        DataManager.StateChanged += OnStateChanged;
    }

    private void OnStateChanged()
        => _ = InvokeAsync(StateHasChanged);

    private void LogoutAsync()
    {
        DataManager.ResetAuth();
        Navigation.NavigateTo("/login");
    }

    public void Dispose()
    {
        DataManager.StateChanged -= OnStateChanged;
    }
}
