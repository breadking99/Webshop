@page "/products"
@using Shared.Queries
@using Shared.Responses

<PageTitle>Products</PageTitle>

<BaseForm TRequest="ProductFilter" TResponse="Response<List<Product>>"
		  Title="Search"
		  SubmitTitle="Apply"
		  LoadingTitle="Loading..."
		  Request="@Filter"
		  Response="@Response"
		  Content="@SearchContent" />

@if (Response.IsLoading)
{
	<p>Loading products...</p>
}
else if (ProductList?.Count >0)
{
	<div class="product-grid">
		@foreach (var product in ProductList)
		{
			<ProductElement Product="@product" />
		}
	</div>
}
else if (Response.IsSuccess)
{
	<p>No products available.</p>
}

<div class="pager-bar">
	<button type="button" @onclick="PrevPage" disabled="@(!CanPrev || Response.IsLoading)">Prev</button>
		<span>Page @Filter.Number</span>
	<button type="button" @onclick="NextPage" disabled="@(ProductList is null || ProductList.Count < Filter.Size || Response.IsLoading)">Next</button>
</div>

@code {
	// Content inside the form: search + pager fields
	private RenderFragment<ProductFilter> SearchContent => (filter) =>
		@<div class="filter-container">
			 <div class="filter-fields">
				 <input class="search-input" placeholder="Search name..." @bind="filter.NameContains" @bind:event="oninput" />
				 <label class="avail-checkbox">
					<input type="checkbox" @bind="filter.OnlyAvailable" /> Only available
				 </label>
				 <div class="pager-fields">
					 <label>Page
						<input type="number" min="1" @bind="filter.Number" />
					 </label>
					 <label>Size
						<input type="number" min="1" max="100" @bind="filter.Size" />
					 </label>
				 </div>
			 </div>
		 </div>;
}
