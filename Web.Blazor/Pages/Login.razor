@page "/login"

@inject IAuthService AuthService
@inject NavigationManager Navigation

<PageTitle>Login</PageTitle>

<BaseForm TRequest="LoginRequest"
          TResponse="Response<AuthData>"
          Title="Login"
          NavTitle="Register"
          ButtonNavigateTo="/register"
          SubmitNavigateTo="/"
          Request="@Request"
          Response="@Response">
    <Content Context="request">
        <Entry @bind-Value="request.Email"
               Label="Email"
               Type="email"
               AutoComplete="email" />
        <Entry @bind-Value="request.Password"
               Label="Password"
               Type="password"
               AutoComplete="current-password" />
    </Content>
</BaseForm>

@code {
    private readonly LoginRequest Request = new();
    private readonly Response<AuthData> Response = new();

    protected override void OnInitialized()
    {
        Response.Update = () => _ = InvokeAsync(StateHasChanged);

        if (DataManager.IsLoggedIn)
        {
            Navigation.NavigateTo("/", true);
            return;
        }

        Response.Request = () => AuthService.PostLoginAsync(Request);
    }
}
